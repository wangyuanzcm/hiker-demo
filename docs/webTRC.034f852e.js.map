{"mappings":"AAIA,aAEA,MAAMA,SAAWC,SAASC,eAAe,YACnCC,UAAYF,SAASC,eAAe,aACpCE,YAAcH,SAASC,eAAe,eACtCG,MAAQJ,SAASK,cAAc,SAErC,IAAIC,cACAC,aAAc,EACdC,cAAgB,GAOpB,SAASC,QAAQC,EAAKC,GACHX,SAASK,cAAc,QAC/BO,WAAa,MAAMF,aACL,IAAVC,GACTE,QAAQF,MAAMA,EAElB,CAGF,SAASG,iBAAiBC,GACxBhB,SAASiB,UAAW,EACpBZ,MAAMa,UAAYF,EAClBG,OAAOH,OAASA,EAEhBA,EAAOI,iBAAiB,GAAGC,iBAAiB,SAAS,KACnDX,QAAQ,aACRV,SAASiB,UAAW,EACpBd,UAAUc,UAAW,CAAI,IAE3Bd,UAAUc,UAAW,CACvB,CAEA,SAASK,MAAMV,GACbF,QAAQ,2BAA2BE,EAAMW,OAAQX,EACnD,CAkBA,SAASY,aACPhB,aAAc,EACdD,cAAckB,OACdrB,YAAYa,UAAW,EACvBd,UAAUuB,YAAc,MAC1B,CAEA,SAASC,iBACPlB,cAAgB,GAChB,MACMmB,EAAU,CAAEC,SADDC,wBAAwB,IAGzC,IACEvB,cAAgB,IAAIwB,cAAcZ,OAAOH,OAAQY,EAInD,CAHE,MAAOI,GAEP,YADAtB,QAAQ,sBAAsBuB,KAAKC,UAAUF,KAE/C,CACA7B,UAAUuB,YAAc,OACxBlB,aAAc,EACdJ,YAAYa,UAAW,EACvBV,cAAc4B,OAAUC,IACtB1B,QAAQ,UAAY0B,EAAA,EAEtB7B,cAAc8B,gBAAkBC,oBAChC/B,cAAcgC,QACd7B,QAAQ,uBAAyBH,cACnC,CAEA,SAAS+B,oBAAoBF,GAC3BtB,QAAQ0B,IAAI,sBAAuBJ,GAC/BA,EAAMK,MAAQL,EAAMK,KAAKC,KAAO,GAClCjC,cAAckC,KAAKP,EAAMK,KAE7B,CAKA,SAASX,wBAOP,MANsB,CACpB,6BACA,6BACA,8BACA,6BAEmBc,QAAOf,GACnBE,cAAcc,gBAAgBhB,IAEzC,CAhGA7B,SAASqB,iBAAiB,SAAS,KACjCyB,UAAUC,aAAaC,gBAAgB,CAAC3C,OAAO,IAC1C4C,KAAKlC,iBAAkBO,MAAA,IA+BzBwB,UAAUC,cAAgB,oBAAqBD,UAAUC,aAC5D/C,SAASiB,UAAW,EAEpBP,QAAQ,oCAGVP,UAAUkB,iBAAiB,SAAS,KAChB,GAAfb,YACDmB,iBAEAH,YAAA,IAuDJpB,YAAYiB,iBAAiB,SAAS,KACpC,MAAM6B,EAAO,IAAIC,KAAK1C,cAAe,CAAE2C,KAAM,eACvCC,EAAMlC,OAAOmC,IAAIC,gBAAgBL,GACjCM,EAAIvD,SAASwD,cAAc,KACjCD,EAAEE,MAAMC,QAAU,OAClBH,EAAEI,KAAOP,EACTG,EAAEK,SAAW,OAAQ,IAAIC,MAAOC,UAAY,QAC5C9D,SAAS+D,KAAKC,YAAYT,GAC1BA,EAAEU,QACFC,YAAW,KACTlE,SAAS+D,KAAKI,YAAYZ,GAC1BrC,OAAOmC,IAAIe,gBAAgBhB,EAAA,GAC1B","sources":["webRTC/js/main.js"],"sourcesContent":["/*\n *  分享屏幕\n */\n\n'use strict';\n\nconst startBtn = document.getElementById('startBtn');\nconst recordBtn = document.getElementById('recordBtn');\nconst downloadBtn = document.getElementById('downloadBtn');\nconst video = document.querySelector('video'); // 预览用的\n\nlet mediaRecorder;\nlet isRecording = false;\nlet recordedBlobs = [];\n\nstartBtn.addEventListener('click', () => {\n  navigator.mediaDevices.getDisplayMedia({video: true})\n      .then(gotDisplayStream, onErr);\n});\n\nfunction showMsg(msg, error) {\n    const msgEle = document.querySelector('#msg');\n    msgEle.innerHTML += `<p>${msg}</p>`;\n    if (typeof error !== 'undefined') {\n      console.error(error);\n    }\n  }\n\n// 拿到屏幕数据流\nfunction gotDisplayStream(stream) {\n  startBtn.disabled = true;\n  video.srcObject = stream; // 显示出来\n  window.stream = stream;   // 缓存一下\n\n  stream.getVideoTracks()[0].addEventListener('ended', () => {\n    showMsg('用户停止了分享屏幕');\n    startBtn.disabled = false;\n    recordBtn.disabled = true;\n  });\n  recordBtn.disabled = false;\n}\n\nfunction onErr(error) {\n  showMsg(`getDisplayMedia on err: ${error.name}`, error);\n}\n\n\n\nif ((navigator.mediaDevices && 'getDisplayMedia' in navigator.mediaDevices)) {\n  startBtn.disabled = false;\n} else {\n  showMsg('getDisplayMedia is not supported');\n}\n\nrecordBtn.addEventListener('click', ()=> {\n  if(isRecording == false) {\n    startRecording();\n  } else {\n    stopRecord();\n  }\n});\n\nfunction stopRecord() {\n  isRecording = false;\n  mediaRecorder.stop();\n  downloadBtn.disabled = false;\n  recordBtn.textContent = \"开始录制\";\n}\n\nfunction startRecording() {\n  recordedBlobs = [];\n  const mimeType = getSupportedMimeTypes()[0];\n  const options = { mimeType };\n\n  try {\n    mediaRecorder = new MediaRecorder(window.stream, options);\n  } catch (e) {\n    showMsg(`创建MediaRecorder出错: ${JSON.stringify(e)}`);\n    return;\n  }\n  recordBtn.textContent = '停止录制';\n  isRecording = true;\n  downloadBtn.disabled = true;\n  mediaRecorder.onstop = (event) => {\n    showMsg('录制停止了: ' + event);\n  };\n  mediaRecorder.ondataavailable = handleDataAvailable;\n  mediaRecorder.start();\n  showMsg('录制开始 mediaRecorder: ' + mediaRecorder);\n}\n\nfunction handleDataAvailable(event) {\n  console.log('handleDataAvailable', event);\n  if (event.data && event.data.size > 0) {\n    recordedBlobs.push(event.data);\n  }\n}\n\n\n\n// 找到支持的格式\nfunction getSupportedMimeTypes() {\n  const possibleTypes = [\n    'video/webm;codecs=vp9,opus',\n    'video/webm;codecs=vp8,opus',\n    'video/webm;codecs=h264,opus',\n    'video/mp4;codecs=h264,aac',\n  ];\n  return possibleTypes.filter(mimeType => {\n    return MediaRecorder.isTypeSupported(mimeType);\n  });\n}\n\ndownloadBtn.addEventListener('click', () => {\n  const blob = new Blob(recordedBlobs, { type: 'video/webm' });\n  const url = window.URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.style.display = 'none';\n  a.href = url;\n  a.download = '录屏_' + new Date().getTime() + '.webm';\n  document.body.appendChild(a);\n  a.click();\n  setTimeout(() => {\n    document.body.removeChild(a);\n    window.URL.revokeObjectURL(url);\n  }, 100);\n});"],"names":["startBtn","document","getElementById","recordBtn","downloadBtn","video","querySelector","mediaRecorder","isRecording","recordedBlobs","showMsg","msg","error","innerHTML","console","gotDisplayStream","stream","disabled","srcObject","window","getVideoTracks","addEventListener","onErr","name","stopRecord","stop","textContent","startRecording","options","mimeType","getSupportedMimeTypes","MediaRecorder","e","JSON","stringify","onstop","event","ondataavailable","handleDataAvailable","start","log","data","size","push","filter","isTypeSupported","navigator","mediaDevices","getDisplayMedia","then","blob","Blob","type","url","URL","createObjectURL","a","createElement","style","display","href","download","Date","getTime","body","appendChild","click","setTimeout","removeChild","revokeObjectURL"],"version":3,"file":"webTRC.034f852e.js.map"}